<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Hoodi Depositor</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        section { margin-bottom: 2em; }
        label { display: block; margin-top: 0.5em; }
        input, select { width: 100%; padding: 0.4em; }
        button { margin-top: 1em; padding: 0.5em 1em; }
        pre { background: #f0f0f0; padding: 1em; overflow-x: auto; }
    </style>
</head>
<body>
<h1>Hoodi Depositor</h1>
<section>
    <h2>Wallets</h2>
    <select id="wallet-select"></select>
    <button onclick="refreshWallets()">Refresh Wallets</button>
</section>

<section>
    <h2>Generate Keystore</h2>
    <label>Index <input id="ks-index" type="number" value="0"></label>
    <label>Num Validators <input id="ks-num" type="number" value="1"></label>
    <label>Mnemonic (optional) <input id="ks-mnemonic" type="text"></label>
    <label>Chain <input id="ks-chain" type="text" value="hoodi"></label>
    <label>Output Directory <input id="ks-dir" type="text" value="validator_keys"></label>
    <button onclick="generateKeystore()">Generate</button>
    <pre id="ks-output"></pre>
</section>

<section>
    <h2>Generate Deposit Data</h2>
    <label>Validator Pubkey <input id="pubkey" type="text"></label>
    <label>Withdrawal Address <input id="withdrawal" type="text"></label>
    <label>Amount (gwei) <input id="amount" type="number" value="32000000000"></label>
    <label>Keystore File <input id="keystore" type="file"></label>
    <label>Password <input id="password" type="password"></label>
    <button onclick="generateDeposit()">Generate</button>
    <pre id="deposit-output"></pre>
</section>

<section>
    <h2>Send Deposit</h2>
    <button onclick="sendDeposit()">Send Deposit Transaction</button>
    <pre id="tx-output"></pre>
</section>

<script>
async function refreshWallets() {
    const res = await fetch('/wallets');
    const wallets = await res.json();
    const sel = document.getElementById('wallet-select');
    sel.innerHTML = '';
    wallets.forEach(w => {
        const opt = document.createElement('option');
        opt.value = w.address;
        opt.textContent = w.address;
        sel.appendChild(opt);
    });
}

async function generateDeposit() {
    const pubkey = document.getElementById('pubkey').value;
    const withdrawal = document.getElementById('withdrawal').value;
    const amount = document.getElementById('amount').value;
    const fileInput = document.getElementById('keystore');
    const password = document.getElementById('password').value;
    if (!fileInput.files.length) { alert('Select keystore file'); return; }
    const form = new FormData();
    form.append('pubkey', pubkey);
    form.append('withdrawal', withdrawal);
    form.append('amount', amount);
    form.append('password', password);
    form.append('keystore', fileInput.files[0]);
    const res = await fetch('/generate_deposit', { method: 'POST', body: form });
    const data = await res.json();
    document.getElementById('deposit-output').textContent = JSON.stringify(data, null, 2);
    window.currentDeposit = data;
}

async function sendDeposit() {
    if (!window.currentDeposit) { alert('Generate deposit first'); return; }
    const address = document.getElementById('wallet-select').value;
    const res = await fetch('/send_deposit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ address: address, deposit: window.currentDeposit })
    });
    const data = await res.json();
    document.getElementById('tx-output').textContent = JSON.stringify(data, null, 2);
}

async function generateKeystore() {
    const payload = {
        index: parseInt(document.getElementById('ks-index').value),
        num_validators: parseInt(document.getElementById('ks-num').value),
        mnemonic: document.getElementById('ks-mnemonic').value || null,
        chain: document.getElementById('ks-chain').value,
        output_dir: document.getElementById('ks-dir').value
    };
    const res = await fetch('/generate_keystore', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });
    const data = await res.json();
    document.getElementById('ks-output').textContent = JSON.stringify(data, null, 2);
}

refreshWallets();
</script>
</body>
</html>
